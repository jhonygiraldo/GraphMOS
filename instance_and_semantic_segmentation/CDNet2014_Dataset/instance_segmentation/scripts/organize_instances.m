clear all, close all, clc;
%% Setting of paths
path_to_change_detection = 'path_to/changedetection_dataset/'; % Change this line with your path to the change detection database
segmentation_algorithm = 'X_101_FPN_COCO';
%%
folder_challenges = {'badWeather';'baseline';'cameraJitter';'dynamicBackground';...
    'intermittentObjectMotion';'lowFramerate';'nightVideos';'PTZ';'shadow';...
    'thermal';'turbulence'};
folders_categories = {{'blizzard';'skating';'snowFall';'wetSnow'};...
    {'PETS2006';'highway';'office';'pedestrians'};...
    {'badminton';'boulevard';'sidewalk';'traffic'};...
    {'boats';'canoe';'fall';'fountain01';'fountain02';'overpass'};...
    {'abandonedBox';'parking';'sofa';'streetLight';'tramstop';'winterDriveway'};...
    {'port_0_17fps';'tramCrossroad_1fps';'tunnelExit_0_35fps';'turnpike_0_5fps'};...
    {'bridgeEntry';'busyBoulvard';'fluidHighway';'streetCornerAtNight';'tramStation';'winterStreet'};...
    {'continuousPan';'intermittentPan';'twoPositionPTZCam';'zoomInZoomOut'};...
    {'backdoor';'bungalows';'busStation';'copyMachine';'cubicle';'peopleInShade'};...
    {'corridor';'diningRoom';'lakeSide';'library';'park'};...
    {'turbulence0';'turbulence1';'turbulence2';'turbulence3'}};
%%
for i=1:length(folder_challenges)
    disp(['Computing sequence: ',folder_challenges{i}]);
    instances_path = [pwd,'/../',segmentation_algorithm,'/raw_instances/results_instances_',...
        folder_challenges{i},'/'];
    for j=1:length(folders_categories{i,1})
        mkdir([pwd,'/../',segmentation_algorithm,'/',folder_challenges{i},'/',...
            folders_categories{i,1}{j,1}]);
    end
    list_instances = dir(instances_path);
    for j=1:length(list_instances)-2
        name_instance = list_instances(j+2).name;
        load([instances_path name_instance]);
        indxs_script = strfind(name_instance,'_');
        sequence = name_instance(indxs_script(end-2)+1:indxs_script(end-1)-1);
        image_name = name_instance(indxs_script(end)+1:end);
        save([pwd,'/../',segmentation_algorithm,'/',folder_challenges{i},'/',...
            sequence,'/',image_name],'masks','classes','boundig_boxes');
    end
end
